// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public"]
}

model Member {
  memberId       Int          @id @default(autoincrement()) @map("id")
  whatsappId     String       @map("whatsapp_id") @unique
  whatsappNumber String       @map("whatsapp_number")
  name           String?
  memberships    Membership[]

  @@map("members")
  @@schema("public")
}

model Membership {
  membershipId  Int       @id @default(autoincrement()) @map("id")
  memberId      Int       @map("member_id")
  groupId       Int       @map("group_id")
  isActive      Boolean   @default(true) @map("is_active")
  isAdmin       Boolean   @default(false) @map("is_admin")
  isOwner       Boolean   @default(false) @map("is_owner")
  dtJoined      DateTime  @default(now()) @map("dt_joined")
  dtLeft        DateTime? @map("dt_left")
  dtLastMessage DateTime? @map("dt_last_message")
  messageCount  Int       @default(0) @map("message_count")

  member   Member    @relation(fields: [memberId], references: [memberId])
  group    Group     @relation(fields: [groupId], references: [groupId])
  warnings Warning[]

  @@unique([memberId, groupId])
  @@map("memberships")
  @@schema("public")
}
model Warning {
  warningId    Int      @id @default(autoincrement()) @map("id")
  membershipId Int      @map("membership_id")
  reason       String
  dtCreated    DateTime @default(now()) @map("dt_created")
  appliedById  Int      @map("applied_by_id") // membership de quem aplicou //0 = sistema

  membership Membership @relation(fields: [membershipId], references: [membershipId])

  @@map("warnings")
  @@schema("public")
}

model Group {
  groupId     Int      @id @default(autoincrement()) @map("id")
  whatsappId  String   @unique @map("whatsapp_id")
  name        String
  description String?
  isClosed    Boolean  @default(false) @map("is_closed")
  openTime    String   @map("open_time") // "10:00"
  closeTime   String   @map("close_time") // "01:00"

  memberships Membership[]

  @@map("groups")
  @@schema("public")
}
